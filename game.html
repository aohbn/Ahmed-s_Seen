<!doctype html><html lang="ar" dir="rtl"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø³ÙŠÙ† Ø¬ÙŠÙ… â€¢ Ø§Ù„Ø¨Ø¯Ø¡</title>
<style>
:root{--bg:#0b1220;--card:#0e172e;--line:#2b3550;--tile1:#1c243a;--tile2:#0d1424;--text:#e7e7ea;--accent:#6c8cff}
*{box-sizing:border-box}body{margin:0;font-family:system-ui,Segoe UI,Tahoma;direction:rtl;background:var(--bg);color:var(--text)}
.container{max-width:1100px;margin:16px auto;padding:12px}
.row{display:flex;gap:10px;align-items:center} .hint{opacity:.8}
.btn{padding:8px 12px;border-radius:10px;border:1px solid #445;background:#1c2539;color:#fff;cursor:pointer}
.btn.primary{background:#5b7cff} .btn.danger{background:#8b2d2d}
.tag{background:#1b2234;padding:6px 10px;border-radius:999px}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0}
.board{display:grid;grid-template-columns:repeat(6,1fr);gap:12px}
.tile{display:grid;place-items:center;min-height:84px;border-radius:16px;background:linear-gradient(180deg,var(--tile1),var(--tile2));border:1px solid var(--line);font-weight:700;cursor:pointer}
.tile.disabled{opacity:.35;cursor:not-allowed}
/* Big category cards */
.catsGrid{display:grid;gap:14px;grid-template-columns:repeat(3,1fr)}
.catCard{background:linear-gradient(180deg,var(--tile1),var(--tile2));border:1px solid var(--line);border-radius:16px;padding:14px;cursor:pointer;min-height:120px;display:flex;flex-direction:column;justify-content:space-between}
.catCard.active{outline:2px solid var(--accent)} .catCard h3{margin:0 0 8px 0;font-size:18px}
.catCard .drop{display:none;margin-top:8px} .catCard.active .drop{display:block} .catCard select{width:100%}
@media(max-width:900px){ .catsGrid{grid-template-columns:repeat(2,1fr)} }
@media(max-width:640px){ .catsGrid{grid-template-columns:1fr} }
.backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;place-items:center;z-index:999}
.modal{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:16px;max-width:980px;width:92vw}
.input{background:#0d1424;color:var(--text);border:1px solid #28324a;border-radius:10px;padding:8px 10px}
.thumb-img{max-height:22vh;max-width:100%;object-fit:contain;border-radius:12px;border:1px solid #e2e8f0;cursor:zoom-in;margin-top:8px}
label.small{font-size:12px;opacity:.9;display:flex;gap:6px;align-items:center}
</style>
</head><body>
<main class="container">

  <div id="setup" class="card">
    <h2 style="margin-top:0">Ø§Ø®ØªØ± 6 ÙØ¦Ø§Øª</h2>

    <!-- Teams bar (names + scores + whose turn) -->
    <div class="row" style="justify-content:space-between;align-items:center;flex-wrap:wrap;margin-bottom:10px">
      <div class="row" style="gap:8px;flex-wrap:wrap">
        <label class="small">Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ 1 <input id="teamAInput" class="input" style="width:150px"></label>
        <label class="small">Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ 2 <input id="teamBInput" class="input" style="width:150px"></label>
        <button class="btn" id="swapTurn2" type="button">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±</button>
      </div>
      <div class="row" style="gap:8px;flex-wrap:wrap">
        <span class="tag"><b id="nameA">Ø§Ù„ÙØ±ÙŠÙ‚ 1</b> â€¢ <span id="scoreA">0</span></span>
        <span class="tag"><b id="nameB">Ø§Ù„ÙØ±ÙŠÙ‚ 2</b> â€¢ <span id="scoreB">0</span></span>
        <span class="tag">Ø§Ù„Ø¯ÙˆØ±: <b id="turn">â€”</b></span>
      </div>
    </div>

    <div id="catsGrid" class="catsGrid"></div>
    <div class="row" style="justify-content:space-between;margin-top:12px">
      <span class="tag" id="selCount">0/6</span>
      <div class="row" style="gap:8px;flex-wrap:wrap">
        <button class="btn primary" id="startBtn" type="button" disabled>Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
      </div>
    </div>
    <div class="hint" id="noData" style="display:none">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯ â€” Ø§Ø³ØªÙˆØ±Ø¯ Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø­ÙØ²Ù….</div>
  </div>

  <div id="play" style="display:none">
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center;flex-wrap:wrap;margin-bottom:6px">
        <div class="row" style="gap:8px;flex-wrap:wrap">
          <span class="tag"><b id="pNameA">Ø§Ù„ÙØ±ÙŠÙ‚ 1</b> â€¢ <span id="pScoreA">0</span></span>
          <button class="btn" id="pAddA" type="button">+100</button>
          <button class="btn" id="pSubA" type="button">-100</button>
          <span class="tag"><b id="pNameB">Ø§Ù„ÙØ±ÙŠÙ‚ 2</b> â€¢ <span id="pScoreB">0</span></span>
          <button class="btn" id="pAddB" type="button">+100</button>
          <button class="btn" id="pSubB" type="button">-100</button>
          <span class="tag">Ø§Ù„Ø¯ÙˆØ±: <b id="pTurn">â€”</b></span>
          <button class="btn" id="swapTurnPlay" type="button">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±</button>
        </div>
      </div>
      <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>
      <div id="board"></div>
    </div>
  </div>
</main>

<!-- Question Modal -->
<div class="backdrop" id="modal" style="display:none">
  <div class="modal">
    <div class="row" style="justify-content:space-between">
      <h3 style="margin:0"><span id="mTitle">â€”</span><span id="mStage"></span></h3>
      <button class="btn" id="closeM" type="button">Ø¥ØºÙ„Ø§Ù‚ âœ•</button>
    </div>
    <div class="row" style="justify-content:space-between;margin:6px 0;flex-wrap:wrap">
      <div class="row">
        <span class="tag" id="timer">00:60</span>
        <button class="btn" id="startTimer" type="button">Ø¨Ø¯Ø¡</button>
        <button class="btn" id="pauseTimer" type="button">Ø¥ÙŠÙ‚Ø§Ù</button>
        <button class="btn" id="resetTimer" type="button">Ø¥Ø¹Ø§Ø¯Ø©</button>
        <button class="btn" id="switchTurnTop" type="button">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ± (10Ø«)</button>
      </div>
      <span class="tag" id="imgTag" style="display:none">ğŸ“· ÙŠÙˆØ¬Ø¯ ØµÙˆØ±Ø©</span>
    </div>
    <div style="margin-top:6px;font-weight:800" id="mQ">â€”</div>
    <img id="mImg" class="thumb-img" style="display:none" />
    <div class="hint" style="margin-top:8px"><b>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:</b> <span id="mA" style="display:none"></span></div>
    <div class="row" style="justify-content:center;margin-top:8px">
      <button class="btn" id="showA" type="button">Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
      <button class="btn" id="openImg" type="button" style="margin-inline-start:8px">Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ù†Ø§ÙØ°Ø©</button>
    </div>

    <div class="row" style="justify-content:space-between;margin-top:8px;flex-wrap:wrap">
      <span class="tag">ÙˆØ³Ø§Ø¦Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù„ÙƒÙ„ ÙØ±ÙŠÙ‚):</span>
      <div class="row">
        <button class="btn" id="stealBtn" type="button">Ø³Ø±Ù‚Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¢Ø®Ø±)</button>
        <button class="btn" id="twoTries" type="button">Ø¥Ø¬Ø§Ø¨ØªØ§Ù†</button>
        <button class="btn" id="doublePts" type="button">Ã—2 Ø§Ù„Ù†Ù‚Ø§Ø·</button>
        <button class="btn" id="plus20" type="button">+20Ø«</button>
      </div>
    </div>

    <div class="row" style="justify-content:space-between;margin-top:10px;flex-wrap:wrap">
      <span class="tag">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØ§Ø¦Ø² Ø¨Ø§Ù„Ø³Ø¤Ø§Ù„:</span>
      <div class="row">
        <button class="btn primary" id="winCur" type="button">Ø§Ù„ÙØ§Ø¦Ø²: Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
        <button class="btn" id="winOth" type="button">Ø§Ù„ÙØ§Ø¦Ø²: Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¢Ø®Ø±</button>
        <button class="btn danger" id="winNone" type="button">Ù„Ø§ Ø£Ø­Ø¯</button>
      </div>
    </div>
  </div>
</div>

<!-- Image Viewer -->
<div class="backdrop" id="imgViewer" style="display:none">
  <div class="modal">
    <div class="row" style="justify-content:space-between"><h3>Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©</h3><button class="btn" id="closeImg" type="button">Ø¥ØºÙ„Ø§Ù‚ âœ•</button></div>
    <div style="display:grid;place-items:center"><img id="viewerImg" style="max-width:100%;max-height:80vh;object-fit:contain;border-radius:12px;border:1px solid #e2e8f0"/></div>
  </div>
</div>

<footer class="container"><span>Ø³ÙŠÙ† Ø¬ÙŠÙ… â€¢ Ø§Ù„Ø¨Ø¯Ø¡</span></footer>

<script type="module">
// ---- storage & schema (no external files) -----
const K={ SETTINGS:"sj:settings", PACKS:"sj:packs", QUESTIONS:"sj:questions", SELECTED_CATS:"sj:selectedCats", SELECTED_PACKS:"sj:selectedPacks", TEAMS:"sj:teamNames", SCORE:"sj:scores" };
const store={ get:(k,f)=>{ try{return JSON.parse(localStorage.getItem(k))??f}catch{return f}}, set:(k,v)=>localStorage.setItem(k,JSON.stringify(v)) };
function defaults(){
  if(!store.get(K.SETTINGS,null)) store.set(K.SETTINGS,{roundTime:60, stealTime:10});
  if(!store.get(K.PACKS,null)) store.set(K.PACKS,[]);
  if(!store.get(K.QUESTIONS,null)) store.set(K.QUESTIONS,[]);
  if(!store.get(K.SELECTED_CATS,null)) store.set(K.SELECTED_CATS,[]);
  if(!store.get(K.SELECTED_PACKS,null)) store.set(K.SELECTED_PACKS,{});
  if(!store.get(K.TEAMS,null)) store.set(K.TEAMS,{teamA:"Ø§Ù„ÙØ±ÙŠÙ‚ 1", teamB:"Ø§Ù„ÙØ±ÙŠÙ‚ 2"});
  if(!store.get(K.SCORE,null)) store.set(K.SCORE,{A:0,B:0,turn:"A",used:{A:{two:false,double:false,plus20:false,steal:false},B:{two:false,double:false,plus20:false,steal:false}}});
}
defaults();
const listPacks=()=>store.get(K.PACKS,[]);
const listQuestions=()=>store.get(K.QUESTIONS,[]);
const packsByCategory=(c)=>listPacks().filter(p=>(p.category||"ØºÙŠØ± Ù…ØµÙ†ÙØ©")===c);
const listCategories=()=>{ const p=Array.from(new Set(listPacks().map(p=>p.category||"ØºÙŠØ± Ù…ØµÙ†ÙØ©"))); return p.length?p:Array.from(new Set(listQuestions().map(q=>q.category||"ØºÙŠØ± Ù…ØµÙ†ÙØ©"))); };
const getSelectedCategories=()=>store.get(K.SELECTED_CATS,[]);
const setSelectedCategories=(v)=>store.set(K.SELECTED_CATS,v||[]);
const getSelectedPacks=()=>store.get(K.SELECTED_PACKS,{});
const setSelectedPacks=(m)=>store.set(K.SELECTED_PACKS,m||{});
const getScores=()=>store.get(K.SCORE,{A:0,B:0,turn:"A",used:{A:{two:false,double:false,plus20:false,steal:false},B:{two:false,double:false,plus20:false,steal:false}}});
const setScores=(s)=>store.set(K.SCORE,s);
const getTeamNames=()=>store.get(K.TEAMS,{teamA:"Ø§Ù„ÙØ±ÙŠÙ‚ 1", teamB:"Ø§Ù„ÙØ±ÙŠÙ‚ 2"});
const setTeamNames=(n)=>store.set(K.TEAMS,n);

// ---- page logic -----
let selectedCats=[]; let selectedPacks=getSelectedPacks(); let boardQuestions={};

function renderScore(){
  const n=getTeamNames(); const s=getScores();
  const nameA=document.getElementById("nameA");
  const nameB=document.getElementById("nameB");
  if(nameA) nameA.textContent=n.teamA;
  if(nameB) nameB.textContent=n.teamB;
  const scoreA=document.getElementById("scoreA");
  const scoreB=document.getElementById("scoreB");
  if(scoreA) scoreA.textContent=s.A;
  if(scoreB) scoreB.textContent=s.B;
  const turn=document.getElementById("turn");
  if(turn) turn.textContent=(s.turn==="A"?n.teamA:n.teamB);
  const pnA=document.getElementById("pNameA"); if(pnA) pnA.textContent=n.teamA;
  const pnB=document.getElementById("pNameB"); if(pnB) pnB.textContent=n.teamB;
  const psA=document.getElementById("pScoreA"); if(psA) psA.textContent=s.A;
  const psB=document.getElementById("pScoreB"); if(psB) psB.textContent=s.B;
  const pT=document.getElementById("pTurn"); if(pT) pT.textContent=(s.turn==="A"?n.teamA:n.teamB);
}
function addPoints(team,pts){ const s=getScores(); s[team]+=pts; if(s[team]<0)s[team]=0; setScores(s); renderScore(); }
function switchTurn(){ const s=getScores(); s.turn=(s.turn==="A"?"B":"A"); setScores(s); renderScore(); }

function bindTeamInputs(){
  const n=getTeamNames();
  const a=document.getElementById("teamAInput");
  const b=document.getElementById("teamBInput");
  if(a) a.value=n.teamA;
  if(b) b.value=n.teamB;
  if(a) a.addEventListener("input",()=>{ const cur=getTeamNames(); setTeamNames({teamA:a.value||"Ø§Ù„ÙØ±ÙŠÙ‚ 1", teamB:cur.teamB}); renderScore(); });
  if(b) b.addEventListener("input",()=>{ const cur=getTeamNames(); setTeamNames({teamA:cur.teamA, teamB:b.value||"Ø§Ù„ÙØ±ÙŠÙ‚ 2"}); renderScore(); });
  const swap=document.getElementById("swapTurn2")||document.getElementById("swapTurn");
  if(swap) swap.onclick=switchTurn;
}

function renderSetup(){
  const all=listCategories(); const grid=document.getElementById("catsGrid"); grid.innerHTML="";
  const saved=getSelectedCategories().filter(c=>all.includes(c)); selectedCats=saved.length?saved.slice(0,6):all.slice(0,6);
  const qs=listQuestions();
  all.forEach(cat=>{
    const card=document.createElement("div"); card.className="catCard"+(selectedCats.includes(cat)?" active":"");
    const title=document.createElement("h3"); title.textContent=cat; card.appendChild(title);
    const total=qs.filter(q=>q.category===cat).length; const meta=document.createElement("div"); meta.className="row";
    // Show current pack instead of "number of questions"
    const packMap=getSelectedPacks(); const packId=packMap[cat]||""; let packLabel="Ù…Ù† ÙƒÙ„ Ø§Ù„Ø­Ø²Ù…"; 
    if(packId){ const pack=listPacks().find(p=>p.id===packId); if(pack) packLabel="Ø§Ù„Ø­Ø²Ù…Ø©: "+pack.name; }
    const tag=document.createElement("span"); tag.className="tag"; tag.textContent=packLabel; meta.appendChild(tag); card.appendChild(meta);
    const drop=document.createElement("div"); drop.className="drop";
    const label=document.createElement("div"); label.textContent="Ø§Ø®ØªØ± Ø§Ù„Ø­Ø²Ù…Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø©:";
    const select=document.createElement("select"); select.className="input";
    const packs=packsByCategory(cat); const optAny=document.createElement("option"); optAny.value=""; optAny.textContent="Ù…Ù† ÙƒÙ„ Ø§Ù„Ø­Ø²Ù…"; select.appendChild(optAny);
    packs.forEach(p=>{ const o=document.createElement("option"); o.value=p.id; o.textContent="Ø­Ø²Ù…Ø©: "+p.name; select.appendChild(o); });
    select.value=(selectedPacks||{})[cat]||""; select.onchange=()=>{ selectedPacks[cat]=select.value||""; setSelectedPacks(selectedPacks); const selObj=packs.find(pp=>pp.id===select.value); tag.textContent = selObj? ("Ø§Ù„Ø­Ø²Ù…Ø©: "+selObj.name) : "Ù…Ù† ÙƒÙ„ Ø§Ù„Ø­Ø²Ù…"; };
    drop.appendChild(label); drop.appendChild(select); card.appendChild(drop);
    card.onclick=(e)=>{ if(e.target===select) return; if(selectedCats.includes(cat)){ selectedCats=selectedCats.filter(x=>x!==cat); card.classList.remove("active"); } else if(selectedCats.length<6){ selectedCats.push(cat); card.classList.add("active"); } setSelectedCategories(selectedCats); document.getElementById("selCount").textContent=(selectedCats?.length||0)+"/6"; document.getElementById("startBtn").disabled=(selectedCats.length!==6); };
    grid.appendChild(card);
  });
  document.getElementById("selCount").textContent=(selectedCats?.length||0)+"/6";
  document.getElementById("startBtn").disabled=(selectedCats.length!==6);
  document.getElementById("noData").style.display=all.length?"none":"block";
}

function buildBoard(){ const qs=listQuestions(); boardQuestions={}; selectedCats.forEach(cat=> boardQuestions[cat]={100:[],200:[],300:[],400:[]}); [100,200,300,400].forEach(level=>{ selectedCats.forEach(cat=>{ const chosen=(selectedPacks||{})[cat]||""; const bucket=qs.filter(q=> q.category===cat && Number(q.level)===level && (!chosen || q.pack===chosen)); boardQuestions[cat][level]=bucket.slice(); }); }); }
function renderBoard(){ const board=document.getElementById("board"); board.innerHTML=""; const head=document.createElement("div"); head.style.display="grid"; head.style.gridTemplateColumns="repeat(6,1fr)"; head.style.gap="12px"; selectedCats.forEach(cat=>{ const h=document.createElement("div"); h.className="tile"; h.style.minHeight="60px"; h.textContent=cat; head.appendChild(h); }); board.appendChild(head); const levels=[100,100,200,200,300,300,400]; levels.forEach(level=>{ const row=document.createElement("div"); row.className="board"; selectedCats.forEach(cat=>{ const pool=boardQuestions[cat][level]||[]; let q=null; if(pool.length){ q=pool.splice(Math.floor(Math.random()*pool.length),1)[0]; } const t=document.createElement("div"); t.className="tile"; t.textContent=level; if(!q) t.classList.add("disabled"); else t.onclick=()=>openModal(q,cat,level,t); row.appendChild(t); }); board.appendChild(row); }); }

// Modal + lifelines
let timer=null, timeLeft=60, stage="regular"; let lifeline={double:false,two:false};
function updT(){ document.getElementById("timer").textContent=String(Math.floor(timeLeft/60)).padStart(2,"0")+":"+String(timeLeft%60).padStart(2,"0"); }
function startT(){ stopT(); timer=setInterval(()=>{ if(timeLeft<=0){ stopT(); onTimeUp(); } else { timeLeft--; updT(); } },1000); }
function stopT(){ if(timer){ clearInterval(timer); timer=null; } }
function onTimeUp(){ if(stage==="regular") toSteal(); }
function toSteal(){ if(stage==="steal") return; const names=getTeamNames(); const s=getScores(); stage="steal"; s.turn=(s.turn==="A"?"B":"A"); setScores(s); renderScore(); timeLeft=10; updT(); document.getElementById("mStage").textContent=" â€” Ø§Ù„Ø³Ø±Ù‚Ø©"; refreshLifelineRow(); }
function plus20(){ timeLeft+=20; updT(); }
function refreshLifelineRow(){ const s=getScores(); const cur=s.turn; const oth=(cur==="A"?"B":"A"); const used=s.used; document.getElementById("twoTries").disabled=!!used[cur].two; document.getElementById("doublePts").disabled=!!used[cur].double; document.getElementById("plus20").disabled=!!used[cur].plus20; document.getElementById("stealBtn").disabled=!!used[oth].steal || stage==="steal"; }
function openModal(q,cat,level,tile){ const names=getTeamNames(); const s=getScores(); const m=document.getElementById("modal"); m.style.display="grid"; stage="regular"; lifeline={double:false,two:false}; timeLeft=60; updT(); document.getElementById("mTitle").textContent=cat+" â€¢ "+level; document.getElementById("mStage").textContent=" â€” Ø§Ù„Ø¯ÙˆØ±: "+(s.turn==="A"?names.teamA:names.teamB); document.getElementById("mQ").textContent=q.q||"â€”"; document.getElementById("mA").textContent=q.a||""; document.getElementById("mA").style.display="none"; const img=document.getElementById("mImg"); const imgBtn=document.getElementById("openImg"); const imgTag=document.getElementById("imgTag"); const vwrap=document.getElementById("imgViewer"); const vimg=document.getElementById("viewerImg"); if(q.img&&String(q.img).length>3){ img.src=q.img; img.style.display="block"; imgTag.style.display="inline-flex"; imgBtn.style.display="inline-block"; img.onclick=()=>{ vimg.src=q.img; vwrap.style.display="grid"; }; imgBtn.onclick=()=>{ vimg.src=q.img; vwrap.style.display="grid"; }; }else{ img.removeAttribute("src"); img.style.display="none"; imgTag.style.display="none"; imgBtn.style.display="none"; } document.getElementById("closeImg").onclick=()=>{ document.getElementById("imgViewer").style.display="none"; }; document.getElementById("showA").onclick=()=>{ const el=document.getElementById("mA"); el.style.display=(el.style.display==="none"?"block":"none"); }; document.getElementById("startTimer").onclick=startT; document.getElementById("pauseTimer").onclick=stopT; document.getElementById("resetTimer").onclick=()=>{ stopT(); timeLeft=(stage==="steal"?10:60); updT(); }; document.getElementById("switchTurnTop").onclick=toSteal; document.getElementById("plus20").onclick=()=>{ const s=getScores(); const cur=s.turn; if(s.used[cur].plus20) return; plus20(); s.used[cur].plus20=true; setScores(s); refreshLifelineRow(); }; document.getElementById("doublePts").onclick=()=>{ const s=getScores(); const cur=s.turn; if(s.used[cur].double) return; lifeline.double=true; s.used[cur].double=true; setScores(s); document.getElementById("doublePts").classList.add("primary"); refreshLifelineRow(); }; document.getElementById("twoTries").onclick=()=>{ const s=getScores(); const cur=s.turn; if(s.used[cur].two) return; lifeline.two=true; s.used[cur].two=true; setScores(s); document.getElementById("twoTries").classList.add("primary"); refreshLifelineRow(); }; document.getElementById("stealBtn").onclick=()=>{ const s=getScores(); const oth=(s.turn==="A"?"B":"A"); if(s.used[oth].steal||stage==="steal") return; s.used[oth].steal=true; s.turn=oth; setScores(s); renderScore(); stage="regular"; document.getElementById("mStage").textContent=" â€” Ø§Ù„Ø¯ÙˆØ±: "+(oth==="A"?names.teamA:names.teamB)+" (Ø³Ø±Ù‚Ø©)"; refreshLifelineRow(); }; document.getElementById("closeM").onclick=()=>{ stopT(); m.style.display="none"; }; const award=(team)=>{ const pts=lifeline.double? level*2 : level; addPoints(team,pts); switchTurn(); stopT(); m.style.display="none"; }; document.getElementById("winCur").onclick=()=>award(getScores().turn); document.getElementById("winOth").onclick=()=>award(getScores().turn==="A"?"B":"A"); document.getElementById("winNone").onclick=()=>{ switchTurn(); stopT(); m.style.display="none"; }; tile.classList.add("disabled"); tile.onclick=null; refreshLifelineRow(); startT(); }

function bindPlayBarControls(){
  const swapPlay=document.getElementById("swapTurnPlay"); if(swapPlay) swapPlay.onclick=switchTurn; bindPlayBarControls();
  const pAddA=document.getElementById("pAddA"); if(pAddA) pAddA.onclick=()=>addPoints("A",100);
  const pSubA=document.getElementById("pSubA"); if(pSubA) pSubA.onclick=()=>addPoints("A",-100);
  const pAddB=document.getElementById("pAddB"); if(pAddB) pAddB.onclick=()=>addPoints("B",100);
  const pSubB=document.getElementById("pSubB"); if(pSubB) pSubB.onclick=()=>addPoints("B",-100);
}

window.addEventListener("DOMContentLoaded",()=>{
  renderScore();
  bindTeamInputs();
  renderSetup();
  document.getElementById("startBtn").onclick=(e)=>{ try{ e?.preventDefault(); buildBoard(); renderBoard(); document.getElementById("setup").style.display="none"; document.getElementById("play").style.display="block"; bindPlayBarControls(); renderScore(); }catch(err){ console.error("Start error",err); alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£Ø³Ø¦Ù„Ø© Ù„Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©."); } };
  const swapBtn=document.getElementById("swapTurn2")||document.getElementById("swapTurn");
  if(swapBtn) swapBtn.onclick=switchTurn;
  const swapPlay=document.getElementById("swapTurnPlay"); if(swapPlay) swapPlay.onclick=switchTurn; bindPlayBarControls();
  const pAddA=document.getElementById("pAddA"); if(pAddA) pAddA.onclick=()=>addPoints("A",100);
  const pSubA=document.getElementById("pSubA"); if(pSubA) pSubA.onclick=()=>addPoints("A",-100);
  const pAddB=document.getElementById("pAddB"); if(pAddB) pAddB.onclick=()=>addPoints("B",100);
  const pSubB=document.getElementById("pSubB"); if(pSubB) pSubB.onclick=()=>addPoints("B",-100);
  const resetBtn=document.getElementById("resetScore");
  if(resetBtn) resetBtn.onclick=()=>{ setScores({A:0,B:0,turn:"A",used:{A:{two:false,double:false,plus20:false,steal:false},B:{two:false,double:false,plus20:false,steal:false}}}); renderScore(); };
});
</script>
</body></html>
