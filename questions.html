
<!doctype html><html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ุณูู ุฌูู โข ุงูุฃุณุฆูุฉ</title>
  <link rel="stylesheet" href="assets/style.css">
  <script type="module">
    import { activateTab, activePack, listQuestionsByPack, addQuestion, updateQuestion, deleteQuestion, distinctCategories, fileToDataURL } from "./assets/app.js";

    let currentPack = '';
    let filter = { category: 'ุงููู', level: 'ุงููู' };

    function renderFilters(){
      const cats = ['ุงููู', ...distinctCategories(currentPack)];
      const sel = document.getElementById('filterCategory');
      sel.innerHTML = cats.map(c=>\`<option>\${c}</option>\`).join('');
    }

    function renderList(){
      const list = document.getElementById('qList'); list.innerHTML='';
      let items = listQuestionsByPack(currentPack);
      if (filter.category !== 'ุงููู') items = items.filter(x=>x.category===filter.category);
      if (filter.level !== 'ุงููู') items = items.filter(x=>String(x.level)===String(filter.level));
      if (!items.length){ list.innerHTML='<div class="hint">ูุง ุชูุฌุฏ ุฃุณุฆูุฉ.</div>'; return; }
      items.forEach(q=>{
        const row = document.createElement('div'); row.className='list-item'; row.style.alignItems='flex-start';
        row.innerHTML = \`
          <div style="max-width:70%">
            <div style="font-weight:800">\${q.category} โข \${q.level}</div>
            <div style="margin-top:6px">\${q.q}</div>
            \${q.img?'<div style="margin-top:6px"><img class="img" src="'+q.img+'" style="max-width:220px;border-radius:8px;border:1px solid #ddd"></div>':''}
            <div class="hint" style="margin-top:6px"><b>ุงูุฅุฌุงุจุฉ:</b> \${q.a}</div>
          </div>
          <div class="row">
            <button class="btn" data-edit="\${q.id}">ุชุนุฏูู</button>
            <button class="btn danger" data-del="\${q.id}">ุญุฐู</button>
          </div>
        \`;
        list.appendChild(row);
      });
      list.querySelectorAll('[data-del]').forEach(b=> b.onclick = ()=>{ if(confirm('ุญุฐู ุงูุณุคุงูุ')){ deleteQuestion(b.dataset.del); renderList(); renderFilters(); } });
      list.querySelectorAll('[data-edit]').forEach(b=> b.onclick = ()=> openEditor(b.dataset.edit));
    }

    function openEditor(id){
      const panel = document.getElementById('editor'); panel.style.display='block';
      const form = panel.querySelector('form');
      const imgPrev = document.getElementById('imgPreview');
      const fileInput = document.getElementById('imgFile');
      form.reset(); imgPrev.src=''; imgPrev.style.display='none';
      form.dataset.id = id || '';
      if (id){
        const q = listQuestionsByPack(currentPack).find(x=>x.id===id);
        form.category.value = q.category; form.level.value = q.level; form.q.value = q.q; form.a.value = q.a;
        if (q.img){ imgPrev.src=q.img; imgPrev.style.display='block'; }
      } else {
        form.category.value = ''; form.level.value = 100;
      }
      fileInput.onchange = async ()=>{
        if(!fileInput.files.length) return;
        const url = await fileToDataURL(fileInput.files[0]);
        imgPrev.src = url; imgPrev.style.display='block';
        form.dataset.img = url;
      };
    }

    function closeEditor(){
      document.getElementById('editor').style.display='none';
      document.getElementById('imgPreview').src=''; document.getElementById('imgPreview').style.display='none';
      const form = document.querySelector('#editor form'); form.reset(); form.dataset.id=''; form.dataset.img='';
    }

    window.addEventListener('DOMContentLoaded', ()=>{
      activateTab('questions.html');
      currentPack = activePack();
      document.getElementById('activePackName').textContent = currentPack;
      renderFilters(); renderList();

      document.getElementById('filterCategory').onchange = (e)=>{ filter.category = e.target.value; renderList(); };
      document.getElementById('filterLevel').onchange = (e)=>{ filter.level = e.target.value; renderList(); };

      document.getElementById('addBtn').onclick = ()=> openEditor(null);
      document.getElementById('cancelBtn').onclick = closeEditor;
      document.getElementById('saveBtn').onclick = (e)=>{
        e.preventDefault();
        const f = document.querySelector('#editor form');
        const payload = { category:f.category.value||'ุบูุฑ ูุตููุฉ', level:Number(f.level.value||100), q:f.q.value||'', a:f.a.value||'', img: f.dataset.img || '' , pack: currentPack };
        if (f.dataset.id){ updateQuestion(f.dataset.id, payload); } else { addQuestion(payload); }
        closeEditor(); renderFilters(); renderList();
      };
    });
  </script>
</head>
<body>
  <header class="nav">
    <div class="container nav-inner">
      <nav class="tabs">
        <a class="tab" href="index.html">ุงูุฑุฆูุณูุฉ</a>
        <a class="tab" href="packs.html">ุงูุญูุฒู</a>
        <a class="tab active" href="questions.html">ุงูุฃุณุฆูุฉ</a>
        <a class="tab" href="game.html">ุงูุจุฏุก</a>
        <a class="tab" href="settings.html">ุงูุฅุนุฏุงุฏุงุช</a>
      </nav>
      <div class="spacer"></div>
      <div class="brand">๐ฎ ุณูู ุฌูู</div>
    </div>
  </header>

  <main class="container">
    <div class="grid cols-3">
      <div class="card">
        <h2>ุฃุณุฆูุฉ ุงูุญุฒูุฉ: <span class="tag" id="activePackName">โ</span></h2>
        <div class="row" style="margin:8px 0">
          <label>ุงููุฆุฉ
            <select id="filterCategory" class="input"></select>
          </label>
          <label>ุงููุณุชูู
            <select id="filterLevel" class="input">
              <option>ุงููู</option>
              <option>100</option><option>200</option><option>300</option><option>400</option><option>500</option>
            </select>
          </label>
          <button class="btn primary" id="addBtn">ุฅุถุงูุฉ ุณุคุงู</button>
        </div>
        <div id="qList" class="list"></div>
      </div>

      <div id="editor" class="card" style="display:none">
        <h3>ุงููุญุฑุฑ</h3>
        <form class="grid">
          <label>ุงููุฆุฉ <input name="category" class="input" placeholder="ูุซุงู: ุฌุบุฑุงููุง"></label>
          <label>ุงููุณุชูู
            <select name="level" class="input">
              <option>100</option><option>200</option><option>300</option><option>400</option><option>500</option>
            </select>
          </label>
          <label>ูุต ุงูุณุคุงู <textarea name="q" class="input" rows="3"></textarea></label>
          <label>ุงูุฅุฌุงุจุฉ <textarea name="a" class="input" rows="2"></textarea></label>
          <label>ุตูุฑุฉ (ุงุฎุชูุงุฑู) <input type="file" id="imgFile" accept="image/*" class="input"></label>
          <img id="imgPreview" class="img" style="display:none;margin-top:6px" />
          <div class="row" style="margin-top:8px">
            <button class="btn primary" id="saveBtn">ุญูุธ</button>
            <button class="btn" id="cancelBtn">ุฅูุบุงุก</button>
          </div>
        </form>
      </div>

      <div class="card">
        <h3>ูุตุงุฆุญ</h3>
        <p class="hint">ุงุณุชุฎุฏู ูุณุชููุงุช 100โ500 ููุง ูู ููุญุฉ v6.5. ููููู ุฅุถุงูุฉ ุตูุฑุฉ ูุฑููุฉ ุจุงูุณุคุงู.</p>
      </div>
    </div>
  </main>

  <footer><span>ุณูู ุฌูู โข ุงูุฃุณุฆูุฉ</span></footer>
</body></html>
