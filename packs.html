<!doctype html><html lang="ar" dir="rtl"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø³ÙŠÙ† Ø¬ÙŠÙ… â€¢ Ø§Ù„Ø­ÙØ²Ù…</title><link rel="stylesheet" href="/assets/style.css">
<script type="module">
  import { listPacks, questionsByPack, addPack, deletePack, deleteCategory, deleteQuestion, deleteAll, exportAll, importAllFromFile, store } from "/assets/app.js";

  function groupByCategory(packs){ const m=new Map(); packs.forEach(p=>{ const k=p.category||'ØºÙŠØ± Ù…ØµÙ†ÙØ©'; if(!m.has(k)) m.set(k,[]); m.get(k).push(p); }); return m; }

  function render(){ const root=document.getElementById('packsGrouped'); root.innerHTML=''; const packs=listPacks(); const grouped=groupByCategory(packs); if(!packs.length){ root.innerHTML='<div class="hint">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­ÙØ²Ù… Ø¨Ø¹Ø¯.</div>'; return; } grouped.forEach((arr,cat)=>{ const card=document.createElement('div'); card.className='card'; card.innerHTML=`<div class="row" style="justify-content:space-between"><h3 class="cat-title" data-cat="\${cat}">\${cat}</h3><div class="row"><button class="btn danger del-cat" data-cat="\${cat}">Ø­Ø°Ù Ø§Ù„ÙØ¦Ø©</button></div></div><div class="list packs" data-cat="\${cat}"></div>`; const list=card.querySelector('.list.packs'); arr.forEach(p=>{ const count=questionsByPack(p.id).length; const row=document.createElement('div'); row.className='list-item'; row.innerHTML=`<span>\${p.name}</span><div class="row"><span class="tag">\${count} Ø³Ø¤Ø§Ù„</span><button class="btn view-pack" data-id="\${p.id}">Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button><button class="btn danger del-pack" data-id="\${p.id}">Ø­Ø°Ù</button></div>`; list.appendChild(row); }); root.appendChild(card); }); }

  function showPackQuestions(packId){ const qs = questionsByPack(packId); const modal=document.getElementById('qModal'); const list=document.getElementById('qList'); list.innerHTML=''; if(!qs.length) list.innerHTML='<div class="hint">Ù„Ø§ Ø£Ø³Ø¦Ù„Ø©.</div>'; qs.forEach(q=>{ const li=document.createElement('div'); li.className='list-item'; li.innerHTML=`<div style="max-width:70%"><div style="font-weight:700">[\${q.level}]</div><div>\${q.q?.slice(0,200)||''}</div><div class="hint">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: \${q.a?.slice(0,120)||''}</div></div><button class="btn danger del-q" data-qid="\${q.id}">Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„</button>`; list.appendChild(li); }); modal.style.display='grid'; modal.dataset.packId=packId; }

  document.addEventListener('DOMContentLoaded',()=>{ render();
    document.getElementById('createBtn').onclick=()=>{ const n=(document.getElementById('packName').value||'').trim(); const c=(document.getElementById('packCat').value||'').trim()||'ØºÙŠØ± Ù…ØµÙ†ÙØ©'; if(!n) return; addPack(n,c); document.getElementById('packName').value=''; render(); };
    document.getElementById('exportBtn').onclick=exportAll;
    document.getElementById('wipeBtn').onclick=()=>{ if(confirm('Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ÙØ²Ù… ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø©ØŸ')){ deleteAll(); render(); } };
    document.getElementById('resetLS').onclick=()=>{ if(confirm('ØªÙØ±ÙŠØº ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…ØªØµÙØ­ (Ø§Ù„Ø­ÙØ²Ù…/Ø§Ù„Ø£Ø³Ø¦Ù„Ø©)ØŸ')){ store.clearAll(); location.reload(); } };

    const fileInput=document.getElementById('importFile'); document.getElementById('importMerge').onclick=()=>{ fileInput.dataset.mode='merge'; fileInput.value=''; fileInput.click(); }; document.getElementById('importReplace').onclick=()=>{ fileInput.dataset.mode='replace'; fileInput.value=''; fileInput.click(); };
    fileInput.onchange=async()=>{ if(!fileInput.files.length) return; const mode=fileInput.dataset.mode||'merge'; try{ await importAllFromFile(fileInput.files[0], mode); document.getElementById('status').textContent='âœ“ ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯'; render(); }catch(e){ document.getElementById('status').textContent='ÙØ´Ù„: '+e.message; } };

    // Robust event delegation (works even if you click a child element)
    document.addEventListener('click',e=>{ 
      const delPackBtn = e.target.closest('button.del-pack'); if(delPackBtn){ if(confirm('Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø©ØŸ')){ deletePack(delPackBtn.dataset.id); render(); } return; }
      const delCatBtn = e.target.closest('button.del-cat'); if(delCatBtn){ if(confirm('Ø­Ø°Ù ÙƒÙ„ Ø­ÙØ²Ù… Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø© ÙˆÙƒÙ„ Ø£Ø³Ø¦Ù„ØªÙ‡Ø§ØŸ')){ deleteCategory(delCatBtn.dataset.cat); render(); } return; }
      const viewBtn = e.target.closest('button.view-pack'); if(viewBtn){ showPackQuestions(viewBtn.dataset.id); return; }
      const delQBtn = e.target.closest('button.del-q'); if(delQBtn){ if(confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ')){ deleteQuestion(delQBtn.dataset.qid); showPackQuestions(document.getElementById('qModal').dataset.packId); render(); } return; }
      if(e.target.id==='closeQModal') document.getElementById('qModal').style.display='none';
    });
  });
</script></head>
<body>
  <header class="nav">
    <div class="container nav-inner">
      <nav class="tabs"><a class="tab" href="/">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a><a class="tab active" href="/packs">Ø§Ù„Ø­ÙØ²Ù…</a><a class="tab" href="/questions">Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</a><a class="tab" href="/game">Ø§Ù„Ø¨Ø¯Ø¡</a><a class="tab" href="/settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a></nav>
      <div class="spacer"></div>
      <div class="brand">ğŸ® Ø³ÙŠÙ† Ø¬ÙŠÙ…</div>
    </div>
  </header>
<main class="container">
  <div class="grid cols-2">
    <div class="card">
      <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø©</h2>
      <div class="grid cols-2">
        <label>Ø§Ø³Ù… Ø§Ù„Ø­Ø²Ù…Ø© <input id="packName" class="input" placeholder="Ù…Ø«Ø§Ù„: Ø¹ÙˆØ§ØµÙ…"></label>
        <label>Ø§Ù„ÙØ¦Ø© <input id="packCat" class="input" placeholder="Ù…Ø«Ø§Ù„: Ø¬ØºØ±Ø§ÙÙŠØ§"></label>
      </div>
      <div class="row" style="margin-top:8px"><button class="btn primary" id="createBtn" type="button">Ø¥Ù†Ø´Ø§Ø¡</button></div>
      <h3 style="margin-top:14px">Ø­ÙØ²Ù…Ùƒ Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©</h3>
      <div id="packsGrouped"></div>
    </div>
    <div class="card">
      <h2>Ø§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ±</h2>
      <p class="hint">ÙŠØ¯Ø¹Ù… JSON Ø§Ù„Ù…Ø³Ø·Ø­ ÙˆØ´ÙƒÙ„ v6.5. ØªÙØ³Ù†Ø¯ Ø§Ù„ÙØ¦Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ØºÙŠØ§Ø¨Ù‡Ø§.</p>
      <div class="row">
        <input type="file" id="importFile" accept="application/json,.json" class="input" style="max-width:280px">
        <button class="btn" id="importMerge" type="button">Ø§Ø³ØªÙŠØ±Ø§Ø¯ (Ø¯Ù…Ø¬)</button>
        <button class="btn danger" id="importReplace" type="button">Ø§Ø³ØªÙŠØ±Ø§Ø¯ (Ø§Ø³ØªØ¨Ø¯Ø§Ù„)</button>
        <button class="btn" id="exportBtn" type="button">ØªØµØ¯ÙŠØ± JSON</button>
        <button class="btn danger" id="wipeBtn" type="button">Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø­ÙØ²Ù…</button>
        <button class="btn" id="resetLS" type="button">ØªÙØ±ÙŠØº Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <span class="hint" id="status"></span>
      </div>
    </div>
  </div>
</main>

<div class="backdrop" id="qModal" style="display:none">
  <div class="modal">
    <div class="row" style="justify-content:space-between"><h3>Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø­Ø²Ù…Ø©</h3><button class="btn" id="closeQModal" type="button">Ø¥ØºÙ„Ø§Ù‚ âœ•</button></div>
    <div id="qList" class="list"></div>
  </div>
</div>

<footer><span>Ø³ÙŠÙ† Ø¬ÙŠÙ… â€¢ Ø§Ù„Ø­ÙØ²Ù…</span></footer>
</body></html>