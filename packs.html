<!doctype html><html lang="ar" dir="rtl"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø³ÙŠÙ† Ø¬ÙŠÙ… â€¢ Ø§Ù„Ø­ÙØ²Ù…</title><link rel="stylesheet" href="/assets/style.css">
<script type="module">
  import { ensureSharedLoaded, listPacks, listCategories, packsByCategory, questionsByPack, addPack, deletePack, deleteCategory, deleteQuestion, deleteAll, exportAll, importAllFromFile, store } from "/assets/app.js";
  let selectedCat = null;

  async function ready(){ await ensureSharedLoaded(); }

  function renderCategories(){
    const wrap = document.getElementById('catList'); wrap.innerHTML='';
    const cats = listCategories();
    if(!cats.length){ wrap.innerHTML='<div class="hint">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¦Ø§Øª Ø¨Ø¹Ø¯.</div>'; document.getElementById('packsCol').innerHTML='<div class="hint">Ø§Ø®ØªØ± ÙØ¦Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­ÙØ²Ù….</div>'; return; }
    if(!selectedCat || !cats.includes(selectedCat)) selectedCat = cats[0];
    cats.forEach(cat=>{ const row=document.createElement('div'); row.className='list-item'; const left=document.createElement('div'); left.textContent=cat; const right=document.createElement('div'); right.className='row';
      const btnSel=document.createElement('button'); btnSel.className='btn'; btnSel.textContent='ÙØªØ­'; btnSel.dataset.cat=cat; btnSel.addEventListener('click',()=>{ selectedCat=cat; renderPacks(); });
      const btnDel=document.createElement('button'); btnDel.className='btn danger'; btnDel.textContent='Ø­Ø°Ù Ø§Ù„ÙØ¦Ø©'; btnDel.dataset.cat=cat; btnDel.addEventListener('click',()=>{ if(confirm('Ø­Ø°Ù Ø§Ù„ÙØ¦Ø© ÙˆØ¬Ù…ÙŠØ¹ Ø­ÙØ²Ù…Ù‡Ø§ØŸ')){ deleteCategory(cat); renderCategories(); renderPacks(); } });
      right.appendChild(btnSel); right.appendChild(btnDel); row.appendChild(left); row.appendChild(right); wrap.appendChild(row); });
    renderPacks();
  }

  function renderPacks(){
    const wrap = document.getElementById('packsCol'); wrap.innerHTML='';
    if(!selectedCat){ wrap.innerHTML='<div class="hint">Ø§Ø®ØªØ± ÙØ¦Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­ÙØ²Ù….</div>'; return; }
    const packs = packsByCategory(selectedCat);
    const title=document.getElementById('packsTitle'); title.textContent='Ø­ÙØ²Ù… â€” '+selectedCat;
    if(!packs.length){ wrap.innerHTML='<div class="hint">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­ÙØ²Ù… Ø¯Ø§Ø®Ù„ Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø©.</div>'; return; }
    packs.forEach(p=>{ const row=document.createElement('div'); row.className='list-item';
      const left=document.createElement('div'); left.textContent=p.name; const right=document.createElement('div'); right.className='row';
      const tag=document.createElement('span'); tag.className='tag'; tag.textContent=questionsByPack(p.id).length+' Ø³Ø¤Ø§Ù„';
      const view=document.createElement('button'); view.className='btn'; view.textContent='Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©'; view.addEventListener('click',()=>showPack(p.id));
      const del=document.createElement('button'); del.className='btn danger'; del.textContent='Ø­Ø°Ù'; del.addEventListener('click',()=>{ if(confirm('Ø­Ø°Ù Ø§Ù„Ø­Ø²Ù…Ø©ØŸ')){ deletePack(p.id); renderPacks(); } });
      right.appendChild(tag); right.appendChild(view); right.appendChild(del); row.appendChild(left); row.appendChild(right); wrap.appendChild(row); });
  }

  function showPack(packId){
    const qs = questionsByPack(packId);
    const modal=document.getElementById('qModal'); const list=document.getElementById('qList'); list.innerHTML='';
    if(!qs.length) list.innerHTML='<div class="hint">Ù„Ø§ Ø£Ø³Ø¦Ù„Ø©.</div>';
    qs.forEach(q=>{ const li=document.createElement('div'); li.className='list-item';
      const content=document.createElement('div'); content.style.maxWidth='70%'; content.innerHTML='<div style="font-weight:700">['+q.level+']</div><div>'+ (q.q||'').slice(0,200) +'</div><div class="hint">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: '+(q.a||'')+'</div>';
      const del=document.createElement('button'); del.className='btn danger'; del.textContent='Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„'; del.addEventListener('click',()=>{ if(confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ')){ deleteQuestion(q.id); showPack(packId); } });
      li.appendChild(content); li.appendChild(del); list.appendChild(li); });
    modal.style.display='grid';
  }

  function createPack(){
    const name=(document.getElementById('packName').value||'').trim();
    const cat =(document.getElementById('packCat').value||'ØºÙŠØ± Ù…ØµÙ†ÙØ©').trim();
    if(!name) return;
    addPack(name, cat);
    document.getElementById('packName').value='';
    selectedCat = cat;
    renderCategories();
  }

  document.addEventListener('DOMContentLoaded', async ()=>{
    await ready();
    renderCategories();
    // Import / Export
    document.getElementById('exportBtn').onclick = exportAll;
    document.getElementById('wipeBtn').onclick = ()=>{ if(confirm('Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ÙØ²Ù… ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø©ØŸ')){ deleteAll(); renderCategories(); } };
    document.getElementById('resetLS').onclick = ()=>{ if(confirm('ØªÙØ±ÙŠØº Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠØŸ')){ store.clearAll(); location.reload(); } };
    const fileInput = document.getElementById('importFile');
    document.getElementById('importMerge').onclick=()=>{ fileInput.dataset.mode='merge'; fileInput.value=''; fileInput.click(); };
    document.getElementById('importReplace').onclick=()=>{ fileInput.dataset.mode='replace'; fileInput.value=''; fileInput.click(); };
    fileInput.onchange = async()=>{ if(!fileInput.files.length) return; const mode=fileInput.dataset.mode||'merge'; try{ await importAllFromFile(fileInput.files[0], mode); document.getElementById('status').textContent='âœ“ ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯'; renderCategories(); }catch(e){ document.getElementById('status').textContent='ÙØ´Ù„: '+e.message; } };
    // Create
    document.getElementById('createBtn').onclick = createPack;
    // Close modal
    document.getElementById('closeQModal').onclick = ()=> document.getElementById('qModal').style.display='none';
  });
</script></head>
<body>
  <header class="nav">
    <div class="container nav-inner">
      <nav class="tabs"><a class="tab" href="/">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a><a class="tab active" href="/packs">Ø§Ù„Ø­ÙØ²Ù…</a><a class="tab" href="/questions">Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</a><a class="tab" href="/game-setup.html">Ø§Ù„Ø¨Ø¯Ø¡</a><a class="tab" href="/settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a></nav>
      <div class="spacer"></div>
      <div class="brand">ğŸ® Ø³ÙŠÙ† Ø¬ÙŠÙ…</div>
    </div>
  </header>
<main class="container">
  <div class="card">
    <h2>Ø§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ±</h2>
    <div class="row">
      <input type="file" id="importFile" accept="application/json,.json" class="input" style="max-width:280px">
      <button class="btn" id="importMerge" type="button">Ø§Ø³ØªÙŠØ±Ø§Ø¯ (Ø¯Ù…Ø¬)</button>
      <button class="btn danger" id="importReplace" type="button">Ø§Ø³ØªÙŠØ±Ø§Ø¯ (Ø§Ø³ØªØ¨Ø¯Ø§Ù„)</button>
      <button class="btn" id="exportBtn" type="button">ØªØµØ¯ÙŠØ± JSON</button>
      <button class="btn danger" id="wipeBtn" type="button">Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø­ÙØ²Ù…</button>
      <button class="btn" id="resetLS" type="button">ØªÙØ±ÙŠØº Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      <span class="hint" id="status"></span>
    </div>
  </div>

  <div class="grid cols-3" style="margin-top:16px">
    <!-- Column 1: Create -->
    <div class="card">
      <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø©</h2>
      <div class="grid cols-2">
        <label>Ø§Ù„ÙØ¦Ø© <input id="packCat" class="input" placeholder="Ù…Ø«Ø§Ù„: Ø¬ØºØ±Ø§ÙÙŠØ§"></label>
        <label>Ø§Ø³Ù… Ø§Ù„Ø­Ø²Ù…Ø© <input id="packName" class="input" placeholder="Ù…Ø«Ø§Ù„: Ø¹ÙˆØ§ØµÙ…"></label>
      </div>
      <div class="row" style="margin-top:8px"><button class="btn primary" id="createBtn" type="button">Ø¥Ù†Ø´Ø§Ø¡</button></div>
    </div>

    <!-- Column 2: Categories -->
    <div class="card">
      <h2>Ø§Ù„ÙØ¦Ø§Øª</h2>
      <div id="catList" class="list"></div>
    </div>

    <!-- Column 3: Packs of selected category -->
    <div class="card">
      <h2 id="packsTitle">Ø­ÙØ²Ù…</h2>
      <div id="packsCol" class="list"></div>
    </div>
  </div>
</main>

<!-- Pack Questions Modal -->
<div class="backdrop" id="qModal" style="display:none">
  <div class="modal">
    <div class="row" style="justify-content:space-between"><h3>Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø­Ø²Ù…Ø©</h3><button class="btn" id="closeQModal" type="button">Ø¥ØºÙ„Ø§Ù‚ âœ•</button></div>
    <div id="qList" class="list"></div>
  </div>
</div>

<footer><span>Ø³ÙŠÙ† Ø¬ÙŠÙ… â€¢ Ø§Ù„Ø­ÙØ²Ù…</span></footer>
</body></html>
