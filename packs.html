
<!doctype html><html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ุณูู ุฌูู โข ุงูุญูุฒู</title>
  <link rel="stylesheet" href="assets/style.css">
  <script type="module">
    import { listPacks, addPack, deletePack, setActivePack, activePack, exportAll, importAllFromFile } from "./assets/app.js";

    function render(){
      const cont = document.getElementById('packsList'); cont.innerHTML='';
      const packs = listPacks();
      const active = activePack();
      document.getElementById('activeName').textContent = packs.find(x=>x.id===active)?.name || 'โ';
      packs.forEach(p=>{
        const row = document.createElement('div'); row.className='list-item';
        row.innerHTML = \`
          <span>\${p.name} \${p.id===active?'<span class="tag">ูุณุชุฎุฏูุฉ</span>':''}</span>
          <span class="row">
            \${p.id!==active?'<button class="btn" data-use="'+p.id+'">ุงุณุชุฎุฏุงู</button>':''}
            \${p.id!=='default'?'<button class="btn danger" data-del="'+p.id+'">ุญุฐู</button>':''}
          </span>\`;
        cont.appendChild(row);
      });
      cont.querySelectorAll('[data-use]').forEach(b=> b.onclick = ()=>{ setActivePack(b.dataset.use); render(); });
      cont.querySelectorAll('[data-del]').forEach(b=> b.onclick = ()=>{
        if(!confirm('ุญุฐู ุงูุญุฒูุฉ ุจูุง ูููุง ูู ุฃุณุฆูุฉุ')) return;
        try { deletePack(b.dataset.del); render(); } catch(e){ alert(e.message); }
      });
    }

    window.addEventListener('DOMContentLoaded', ()=>{
      render();
      document.getElementById('createBtn').onclick = ()=>{
        const name = (document.getElementById('packName').value||'').trim(); if(!name) return;
        try { addPack(name); document.getElementById('packName').value=''; render(); } catch(e){ alert(e.message); }
      };
      document.getElementById('exportBtn').onclick = exportAll;

      const fileInput = document.getElementById('importFile');
      const importRow = document.getElementById('importRow');
      const importHint = document.getElementById('importHint');
      ;['dragenter','dragover'].forEach(evt=>importRow.addEventListener(evt, e=>{e.preventDefault();importRow.style.boxShadow='0 0 0 3px rgba(110,231,243,.3) inset';}));
      ;['dragleave','drop'].forEach(evt=>importRow.addEventListener(evt, e=>{e.preventDefault();importRow.style.boxShadow='none';}));
      importRow.addEventListener('drop', async (e)=>{
        const f = e.dataTransfer.files && e.dataTransfer.files[0];
        if(!f) return;
        try { importHint.textContent='...ุฌุงุฑู ุงูุงุณุชูุฑุงุฏ'; await importAllFromFile(f, 'merge'); importHint.textContent='โ ุชู'; render(); }
        catch(err){ importHint.textContent='ูุดู: '+err.message; }
      });
      document.getElementById('importMerge').onclick = ()=>{ fileInput.dataset.mode='merge'; try{ fileInput.value=''; if(fileInput.showPicker){ fileInput.showPicker(); } else { fileInput.click(); } }catch(e){ fileInput.click(); } };
      document.getElementById('importReplace').onclick = ()=>{ fileInput.dataset.mode='replace'; try{ fileInput.value=''; if(fileInput.showPicker){ fileInput.showPicker(); } else { fileInput.click(); } }catch(e){ fileInput.click(); } };
      fileInput.onchange = async ()=>{
        if(!fileInput.files.length) return;
        const mode = fileInput.dataset.mode || 'merge';
        try {
          importHint.textContent='...ุฌุงุฑู ุงูุงุณุชูุฑุงุฏ';
          await importAllFromFile(fileInput.files[0], mode);
          importHint.textContent='โ ุชู ('+(mode==='replace'?'ุงุณุชุจุฏุงู':'ุฏูุฌ')+')';
          render();
        } catch(e){
          importHint.textContent='ูุดู: '+ e.message;
        } finally { fileInput.value=''; fileInput.dataset.mode='merge'; }
      };
    });
  </script>
</head>
<body>
  <header class="nav">
    <div class="container nav-inner">
      <nav class="tabs">
        <a class="tab" href="index.html">ุงูุฑุฆูุณูุฉ</a>
        <a class="tab active" href="packs.html">ุงูุญูุฒู</a>
        <a class="tab" href="questions.html">ุงูุฃุณุฆูุฉ</a>
        <a class="tab" href="game.html">ุงูุจุฏุก</a>
        <a class="tab" href="settings.html">ุงูุฅุนุฏุงุฏุงุช</a>
      </nav>
      <div class="spacer"></div>
      <div class="brand">๐ฎ ุณูู ุฌูู</div>
    </div>
  </header>

  <main class="container">
    <div class="grid cols-2">
      <div class="card">
        <h2>ุงูุญุฒูุฉ ุงููุดุทุฉ: <span class="tag" id="activeName">โ</span></h2>
        <div class="grid cols-2">
          <label>ุงุณู ุงูุญุฒูุฉ <input id="packName" class="input" placeholder="ูุซุงู: ุซูุงูุฉ ุนุงูุฉ"></label>
          <div class="row" style="align-items:flex-end"><button class="btn primary" id="createBtn">ุฅูุดุงุก</button></div>
        </div>
        <h3 style="margin-top:14px">ุญูุฒูู</h3>
        <div id="packsList" class="list"></div>
      </div>

      <div class="card">
        <h3>ุงุณุชูุฑุงุฏ/ุชุตุฏูุฑ</h3>
        <p class="hint">ูุฏุนู JSON ุจุงูุดูู ุงููุณุทุญ ุฃู ุดูู v6.5 (ููุชุดู ุชููุงุฆููุง).</p>
        <div class="row" style="margin-top:8px" id="importRow">
          <button class="btn" id="exportBtn">ุชุตุฏูุฑ JSON</button>
          <button class="btn" id="importMerge">ุงุณุชูุฑุงุฏ (ุฏูุฌ)</button>
          <button class="btn danger" id="importReplace">ุงุณุชูุฑุงุฏ (ุงุณุชุจุฏุงู)</button><span class="hint" id="importHint"></span>
          <input type="file" id="importFile" accept="application/json,.json" style="position:absolute;left:-9999px;opacity:0;width:1px;height:1px" data-mode="merge">
        </div>
      </div>
    </div>
  </main>
  <footer><span>ุณูู ุฌูู โข ุงูุญูุฒู</span></footer>
</body></html>
